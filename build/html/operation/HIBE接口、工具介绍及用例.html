

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>5. HIBE 教程 &mdash; chainmaker-docs v1.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. 版本升级操作指南" href="%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97.html" />
    <link rel="prev" title="4. 配置变更" href="%E9%85%8D%E7%BD%AE%E5%8F%98%E6%9B%B4.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> chainmaker-docs
          

          
          </a>

          
            
            
              <div class="version">
                v1.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">长安链介绍:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/%E5%B9%B3%E5%8F%B0%E7%AE%80%E4%BB%8B.html">1. 长安链底层技术平台简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/%E8%83%8C%E6%99%AF.html">2. 背景</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/%E5%9F%BA%E7%A1%80%E6%9C%AF%E8%AF%AD.html">3. 基础术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/%E7%BC%96%E5%86%99%E8%AF%AD%E8%A8%80.html">4. 编写语言</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/%E7%89%88%E6%9C%AC%E8%BF%AD%E4%BB%A3.html">5. 版本迭代</a></li>
</ul>
<p class="caption"><span class="caption-text">快速入门</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html">1. 概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html#id2">2. 环境依赖</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html#id5">3. 环境搭建</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html#id16">4. 功能验证</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html#goland">5. 开发-goland启动链</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html#id30">6. 常见问题</a></li>
</ul>
<p class="caption"><span class="caption-text">技术设计文档:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tech/%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84.html">1. 整体架构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B.html">2. 核心流程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html">3. 数据结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA.html">4. 智能合约与虚拟机</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95.html">5. 共识算法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/P2P%E7%BD%91%E7%BB%9C.html">6. P2P网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/RPC%E6%9C%8D%E5%8A%A1.html">7. RPC服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.html">8. 数据存储</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/%E8%BA%AB%E4%BB%BD%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86.html">9. 身份权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95.html">10. 加密算法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/%E4%BA%A4%E6%98%93%E7%BC%93%E5%AD%98.html">11. 交易缓存</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tech/%E5%B9%B6%E8%A1%8C%E8%B0%83%E5%BA%A6.html">12. 并行调度</a></li>
</ul>
<p class="caption"><span class="caption-text">开发指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6.html">1. 智能合约</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/SDK.html">2. SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7.html">3. 命令行工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/%E8%AF%81%E4%B9%A6%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7.html">4. 证书生成工具</a></li>
</ul>
<p class="caption"><span class="caption-text">进阶开发</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="%E5%A4%9A%E6%9C%BA%E9%83%A8%E7%BD%B2.html">1. 多机部署</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E7%9B%91%E6%8E%A7%E8%BF%90%E7%BB%B4.html">2. 运维监控</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E8%87%AA%E6%8B%89%E8%B5%B7%E6%9C%8D%E5%8A%A1.html">3. 自拉起服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%85%8D%E7%BD%AE%E5%8F%98%E6%9B%B4.html">4. 配置变更</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. HIBE 教程</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">5.1. 接口、工具介绍</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cmc-hibe">5.1.1. 生成工具 CMC 子命令——hibe 介绍</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">5.1.1.1. 简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="#init">5.1.1.2. init简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getparams">5.1.1.3. getParams简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="#genprivkey">5.1.1.4. genPrivKey简介</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common">5.1.2. <code class="docutils literal notranslate"><span class="pre">common</span></code>提供的加密和解密方法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">5.1.2.1. 加密，并封装信息的方法</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">5.1.2.2. 解密，返回原始信息的字节数组的方法</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sdk">5.1.3. SDK</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#payload">5.1.3.1. 创建生成身份分层参数初始化交易 payload</a></li>
<li class="toctree-l4"><a class="reference internal" href="#payload-params">5.1.3.2. 生成身份分层加密交易 payload params，加密参数已知</a></li>
<li class="toctree-l4"><a class="reference internal" href="#payload-params-hibe-params-receiverorgids">5.1.3.3. 生成身份分层加密交易 payload params，hibe.Params根据 <code class="docutils literal notranslate"><span class="pre">receiverOrgIds</span></code> 链上查询得出</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">5.1.3.4. 查询某一组织的加密公共参数</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id6">5.2. 用例</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">5.2.1. 使用 cmc hibe 进行初始化工作</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">5.2.1.1. 初始化组织分层架构</a></li>
<li class="toctree-l4"><a class="reference internal" href="#orgid-hibeparams">5.2.1.2. 根据根路径和Orgid查看生成的 hibeParams 具体存储路径</a></li>
<li class="toctree-l4"><a class="reference internal" href="#masterkey">5.2.1.3. 根据MasterKey生成私钥</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">5.2.1.4. 私钥文件分发到下属，各自保管，我们在这里把自己的私钥放在在SDK如下路径：</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id10">5.2.2. 编写智能合约</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#go">5.2.2.1. 使用 go 编写测试的智能合约</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">5.2.2.2. 编译字节码文件放到项目中</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id12">5.2.3. 使用SDK和密钥文件对信息加密上链并从链上获取和加密</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hibekey">5.2.3.1. HIBE相关消息Key规定</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">5.2.3.2. 前置数据</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">5.2.3.3. 初始化客户端，进行测试</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">5.2.3.4. 创建合约</a></li>
<li class="toctree-l4"><a class="reference internal" href="#params">5.2.3.5. 本地 params 上链</a></li>
<li class="toctree-l4"><a class="reference internal" href="#idparams">5.2.3.6. 根据组织Id链上查询其公司Params</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">5.2.3.7. hibe加密信息上链</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hibemsg">5.2.3.8. 获取链上的 <code class="docutils literal notranslate"><span class="pre">hibeMsg</span></code> 并解密：</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">5.2.3.9. 执行测试：</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97.html">6. 版本升级操作指南</a></li>
</ul>
<p class="caption"><span class="caption-text">应用场景</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usecase/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D.html">1. 供应链金融</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usecase/%E7%A2%B3%E4%BA%A4%E6%98%93.html">2. 碳交易</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usecase/%E5%86%B7%E9%93%BE%E6%BA%AF%E6%BA%90.html">3. 冷链溯源</a></li>
</ul>
<p class="caption"><span class="caption-text">关于作者</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../author/%E5%85%B3%E4%BA%8E%E4%BD%9C%E8%80%85.html">1. 关于作者</a></li>
</ul>
<p class="caption"><span class="caption-text">鸣谢</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../thanks/%E9%B8%A3%E8%B0%A2.html">1. 鸣谢</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">chainmaker-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">5. </span>HIBE 教程</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/operation/HIBE接口、工具介绍及用例.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hibe">
<h1><span class="section-number">5. </span>HIBE 教程<a class="headerlink" href="#hibe" title="Permalink to this headline">¶</a></h1>
<p>本文分为两部分：</p>
<ol class="simple">
<li><p>方案接口、工具介绍：对 ChainMaker·长安链的 HIBE SDK 接口、cmc 工具和 common 库提供的算法的介绍。</p></li>
<li><p>用例：介绍了如何使用 ChainMaker·长安链 HIBE 特性，从 HIBE 系统初始化、编写智能合约，到使用 SDK（本文使用 go 的 SDK） 进行数据的加密上链、获取链上数据解密。</p></li>
</ol>
<div class="section" id="id1">
<h2><span class="section-number">5.1. </span>接口、工具介绍<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cmc-hibe">
<h3><span class="section-number">5.1.1. </span>生成工具 CMC 子命令——hibe 介绍<a class="headerlink" href="#cmc-hibe" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id2">
<h4><span class="section-number">5.1.1.1. </span>简介<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>CMC 中的 hibe 命令是管理、使用HIBE身份层级加密的辅助工具，用于初始化一个公司的系统层级，生成<code class="docutils literal notranslate"><span class="pre">params</span></code>、<code class="docutils literal notranslate"><span class="pre">MasterKey</span></code>、根据参数生成成员的<code class="docutils literal notranslate"><span class="pre">privateKey</span></code>，并保存到本地文件，由上司去分发。</p>
<p>使用命令<code class="docutils literal notranslate"><span class="pre">./cmc</span> <span class="pre">-hibe</span> <span class="pre">-h</span></code> 查看命令该子命令详细提示：</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./cmc hibe -h
ChainMaker hibe <span class="nb">command</span>

Usage:
  cmc hibe <span class="o">[</span>command<span class="o">]</span>

Available Commands:
  genPrvKey   generates a key <span class="k">for</span> an Id using the master key
  getParams   getParams storage path
  init        setup generates the system parameters

Flags:
  -h, --help   <span class="nb">help</span> <span class="k">for</span> hibe

Use <span class="s2">&quot;cmc hibe [command] --help&quot;</span> <span class="k">for</span> more information about a command.
</pre></div>
</div>
</div>
<div class="section" id="init">
<h4><span class="section-number">5.1.1.2. </span>init简介<a class="headerlink" href="#init" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">init</span></code>用于初始化一个系统层级结构。</p>
<p>查看命令详情<code class="docutils literal notranslate"><span class="pre">./</span> <span class="pre">cmc</span> <span class="pre">hibe</span> <span class="pre">init</span> <span class="pre">-h</span></code>：</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./cmc hibe init -h
setup generates the system parameters

Usage:
  cmc hibe init [flags]

Flags:
  -h, --help           help for init
  -l, --level string   the parameter &quot;l&quot; is the maxi depth that the hierarchy will support.
  -o, --orgId string   the result storage name, please enter your orgId
  -s, --spath string   the result storage path, include org&#39;s params、MasterKey
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">init</span></code>参数详解：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"> <span class="pre">-h,</span> <span class="pre">--help</span></code>：输出命令提示信息</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-l,</span> <span class="pre">--level</span></code>：构造的系统层级支持的最大深度，接受一个字符串，内部转成int，请输入合法的数字字符串</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o,</span> <span class="pre">--orgId</span></code>：构造的组织或公司的 <code class="docutils literal notranslate"><span class="pre">orgId</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s,</span> <span class="pre">--spath</span></code>：初始化之后返回的<code class="docutils literal notranslate"><span class="pre">params</span></code>、<code class="docutils literal notranslate"><span class="pre">masterKey</span></code> 存储路径</p></li>
</ul>
</div>
<div class="section" id="getparams">
<h4><span class="section-number">5.1.1.3. </span>getParams简介<a class="headerlink" href="#getparams" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">getParams</span></code>用于获取初始化后<code class="docutils literal notranslate"><span class="pre">Params</span></code>文件的具体存储路径并打印<code class="docutils literal notranslate"><span class="pre">Params</span></code>，要求输入组织名和设置的根目录。</p>
<p><code class="docutils literal notranslate"><span class="pre">./cmc</span> <span class="pre">hibe</span> <span class="pre">getParams</span> <span class="pre">-h</span></code>查看命令详情：</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./cmc hibe getParams -h
getParams storage path

Usage:
  cmc hibe getParams <span class="o">[</span>flags<span class="o">]</span>

Flags:
  -h, --help           <span class="nb">help</span> <span class="k">for</span> getParams
  -o, --orgId string   the result storage name, please enter your orgId
  -p, --path string    the init path
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">getParams</span></code>参数详解：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-h,</span> <span class="pre">--help</span></code>：查看命令详细信息</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o,</span> <span class="pre">--orgId</span></code>：组织名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-p,</span> <span class="pre">--path</span></code>：初始化时的根路径</p></li>
</ul>
</div>
<div class="section" id="genprivkey">
<h4><span class="section-number">5.1.1.4. </span>genPrivKey简介<a class="headerlink" href="#genprivkey" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">genPrivKey</span></code>为下属生成<code class="docutils literal notranslate"><span class="pre">privateKey</span></code>，存储在本地文件，由生成者颁发私钥文件给下属。</p>
<p>该命令由两种方式，基于<code class="docutils literal notranslate"><span class="pre">parentKey</span></code>和<code class="docutils literal notranslate"><span class="pre">masterKey</span></code>，由<code class="docutils literal notranslate"><span class="pre">flag</span></code>控制。</p>
<p>查看该命令详细提示：</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./cmc hibe genPrvKey -h
generates a key for an Id using the master key

Usage:
  cmc hibe genPrvKey [flags]

Flags:
  -m, --fromMaster int   generate prvKey from masterKey or privateKey, 1 from master, 0 from parent, m default is 0
  -h, --help             help for genPrvKey
  -i, --id string        get the private key of the ID, Must be formatted in the sample format with&quot; / &quot;, for example: id org1/ou1/Alice
  -k, --kpath string     the masterKey Or parentKey file path
  -o, --orgId string     the result storage name, please enter your orgId
  -p, --ppath string     the hibe params file&#39;s path
  -s, --spath string     the result storage file path, and the file name is the id
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">genPrivKey</span></code>参数详解：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-h,</span> <span class="pre">--help</span></code>：查看命令详细信息</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-m,</span> <span class="pre">--fromMaster</span></code>：传入<code class="docutils literal notranslate"><span class="pre">1</span></code>和<code class="docutils literal notranslate"><span class="pre">0</span></code>，<code class="docutils literal notranslate"><span class="pre">1</span></code>标识根据<code class="docutils literal notranslate"><span class="pre">MasterKey</span></code>生成私钥，<code class="docutils literal notranslate"><span class="pre">-k,</span> <span class="pre">--kpath</span></code>中就要提供<code class="docutils literal notranslate"><span class="pre">MasterKey</span></code>的存储路径 ，<code class="docutils literal notranslate"><span class="pre">0</span></code>标识根据<code class="docutils literal notranslate"><span class="pre">ParentKey</span></code>生成私钥，<code class="docutils literal notranslate"><span class="pre">-k</span></code>中提供上级私钥的存储路径，默认值为 <code class="docutils literal notranslate"><span class="pre">0</span></code>，根据<code class="docutils literal notranslate"><span class="pre">ParentKey</span></code>生成私钥</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i,</span> <span class="pre">--id</span></code>：当前生成私钥的<code class="docutils literal notranslate"><span class="pre">Id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o,</span> <span class="pre">--orgId</span></code>: 指定组织<code class="docutils literal notranslate"><span class="pre">orgId</span></code>，会根据<code class="docutils literal notranslate"><span class="pre">orgId</span></code>分文件夹保存生成的私钥，方便管理</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-k,</span> <span class="pre">--kpath</span></code>：<code class="docutils literal notranslate"><span class="pre">MasterKey</span></code>或者<code class="docutils literal notranslate"><span class="pre">ParentKey</span></code>的存储路径</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-p,</span> <span class="pre">--ppath</span></code>：<code class="docutils literal notranslate"><span class="pre">params</span></code> 存储路径</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s,</span> <span class="pre">--spath</span></code>：生成的私钥存储的根路径（私钥会在根路径中根据组织<code class="docutils literal notranslate"><span class="pre">Id</span></code>创建指定文件夹，几种管理每个公司的私钥，私钥文件以<em>ID.privatekey</em>命名）</p></li>
</ul>
</div>
</div>
<div class="section" id="common">
<h3><span class="section-number">5.1.2. </span><code class="docutils literal notranslate"><span class="pre">common</span></code>提供的加密和解密方法<a class="headerlink" href="#common" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id3">
<h4><span class="section-number">5.1.2.1. </span>加密，并封装信息的方法<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p><strong>参数介绍：</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">plaintext</span></code>：待加密明文信息</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">receiverIds</span></code>: 消息接收者对应的加密参数，需和<code class="docutils literal notranslate"><span class="pre">paramsList</span></code> 一一对应</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">paramsList</span></code>: 与<code class="docutils literal notranslate"><span class="pre">receiverIds</span></code>对应的<code class="docutils literal notranslate"><span class="pre">hibe</span></code>系统参数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyType</span></code>: 对明文进行对称加密的方法，请传入 <code class="docutils literal notranslate"><span class="pre">common</span></code> 项目中 <code class="docutils literal notranslate"><span class="pre">crypto</span></code> 包提供的方法，目前提供<code class="docutils literal notranslate"><span class="pre">AES</span></code>和<code class="docutils literal notranslate"><span class="pre">SM4</span></code>两种方法，key长度已在内部指定统一使用 <code class="docutils literal notranslate"><span class="pre">128bit</span></code> 长度类型的</p></li>
</ul>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">EncryptHibeMsg</span><span class="p">(</span><span class="nx">plaintext</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">receiverIds</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">paramsList</span> <span class="p">[]</span><span class="o">*</span><span class="nx">hibe</span><span class="p">.</span><span class="nx">Params</span><span class="p">,</span>
                    <span class="nx">symKeyType</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">KeyType</span><span class="p">)</span> <span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4><span class="section-number">5.1.2.2. </span>解密，返回原始信息的字节数组的方法<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p><strong>参数介绍：</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">localId</span></code>: 本地身份分层加密 <code class="docutils literal notranslate"><span class="pre">id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hibeParams</span></code>: 本地身份分层加密系统参数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">privKey</span></code>: 本地身份分层加密私钥</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hibeMsgMap</span></code>: 身份分层加密交易的链上获取信息</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyType</span></code>: 对加密信息进行对称解密的方法，请和加密时使用的方法保持一致，请传入 <code class="docutils literal notranslate"><span class="pre">common</span></code> 中 <code class="docutils literal notranslate"><span class="pre">crypto</span></code> 包提供的方法，目前提供<code class="docutils literal notranslate"><span class="pre">AES</span></code>和<code class="docutils literal notranslate"><span class="pre">SM4</span></code>两种方法，<code class="docutils literal notranslate"><span class="pre">key</span></code>长度已在内部指定统一使用<code class="docutils literal notranslate"><span class="pre">128bit</span></code>长度类型的</p></li>
</ul>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">DecryptHibeMsg</span><span class="p">(</span><span class="nx">localId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">hibeParams</span> <span class="o">*</span><span class="nx">hibe</span><span class="p">.</span><span class="nx">Params</span><span class="p">,</span> <span class="nx">prvKey</span> <span class="o">*</span><span class="nx">hibe</span><span class="p">.</span><span class="nx">PrivateKey</span><span class="p">,</span>
                    <span class="nx">hibeMsgMap</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">symKeyType</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">KeyType</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sdk">
<h3><span class="section-number">5.1.3. </span>SDK<a class="headerlink" href="#sdk" title="Permalink to this headline">¶</a></h3>
<p>身份分层加密类接口</p>
<blockquote>
<div><p>注意：身份分层加密模块 <code class="docutils literal notranslate"><span class="pre">Id</span></code> 使用 <code class="docutils literal notranslate"><span class="pre">/</span></code> 作为分隔符，例如： <code class="docutils literal notranslate"><span class="pre">Org1/Ou1/Member1</span></code>
身份 <code class="docutils literal notranslate"><span class="pre">Id</span></code> 中禁用符号 <code class="docutils literal notranslate"><span class="pre">#</span></code> ，<code class="docutils literal notranslate"><span class="pre">/</span></code>在文件名中无法使用，我们采用 <code class="docutils literal notranslate"><span class="pre">#</span></code> 作为保存私钥的文件名 <code class="docutils literal notranslate"><span class="pre">Id</span></code>分隔符，替换掉 <code class="docutils literal notranslate"><span class="pre">/</span></code>，使用 <code class="docutils literal notranslate"><span class="pre">#</span></code> 做分隔符在使用cmc
工具的时候会正常上下级匹配不到的状况。</p>
</div></blockquote>
<div class="section" id="payload">
<h4><span class="section-number">5.1.3.1. </span>创建生成身份分层参数初始化交易 payload<a class="headerlink" href="#payload" title="Permalink to this headline">¶</a></h4>
<p><strong>参数说明</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contractName</span></code>：合约名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orgId</span></code>：组织<code class="docutils literal notranslate"><span class="pre">Id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hibeParamsFilePath</span></code>：<code class="docutils literal notranslate"><span class="pre">hibe.Params</span></code>存储文件位置</p></li>
</ul>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="nx">CreateHibeInitParamsTransactionPayloadParams</span><span class="p">(</span><span class="nx">contractName</span><span class="p">,</span> <span class="nx">orgId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">hibeParamsFilePath</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="payload-params">
<h4><span class="section-number">5.1.3.2. </span>生成身份分层加密交易 payload params，加密参数已知<a class="headerlink" href="#payload-params" title="Permalink to this headline">¶</a></h4>
<p><strong>参数说明</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">plaintext</span></code>: 待加密交易消息明文</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">receiverIds</span></code>: 消息接收者对应的加密参数，需和<code class="docutils literal notranslate"><span class="pre">paramsList</span></code> 一一对应</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">paramsBytesList</span></code>: 消息接收者对应的加密参数，需和 <code class="docutils literal notranslate"><span class="pre">receiverIds</span></code> 一一对应</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txId</span></code>: 交易 Id 作为链上存储 hibeMsg 的 Key, 如果不提供存储的信息可能被覆盖</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyType</span></code>: 对明文进行对称加密的方法，请传入 <code class="docutils literal notranslate"><span class="pre">common</span></code> 项目中 <code class="docutils literal notranslate"><span class="pre">crypto</span></code> 包提供的方法，目前提供<code class="docutils literal notranslate"><span class="pre">AES</span></code>和<code class="docutils literal notranslate"><span class="pre">SM4</span></code>f两种方法</p></li>
</ul>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="nx">CreateHibeTxPayloadParamsWithHibeParams</span><span class="p">(</span><span class="nx">plaintext</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">receiverIds</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">paramsBytesList</span> <span class="p">[][]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">txId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">keyType</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">KeyType</span><span class="p">)</span> <span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="payload-params-hibe-params-receiverorgids">
<h4><span class="section-number">5.1.3.3. </span>生成身份分层加密交易 payload params，hibe.Params根据 <code class="docutils literal notranslate"><span class="pre">receiverOrgIds</span></code> 链上查询得出<a class="headerlink" href="#payload-params-hibe-params-receiverorgids" title="Permalink to this headline">¶</a></h4>
<p><strong>参数说明</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contractName</span></code>: 合约名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queryParamsMethod</span></code>: 查询链上<code class="docutils literal notranslate"><span class="pre">hibe.Params</span></code>合约方法名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plaintext</span></code>: 交易信息</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">receiverIds</span></code>: 消息接收者对应的加密参数，需和<code class="docutils literal notranslate"><span class="pre">paramsList</span></code> 一一对应</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">paramsList</span></code>: 消息接收者对应的加密参数，需和 <code class="docutils literal notranslate"><span class="pre">receiverIds</span></code> 一一对应</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">receiverOrgIds</span></code>: 链上查询 hibe Params 的 Key 列表，需要和 <code class="docutils literal notranslate"><span class="pre">receiverIds</span></code> 一一对应</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txId</span></code>: 交易 Id 作为链上存储 hibeMsg 的 Key, 如果不提供存储的信息可能被覆盖</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyType</span></code>: 对明文进行对称加密的方法，请传入 <code class="docutils literal notranslate"><span class="pre">common</span></code> 项目中 <code class="docutils literal notranslate"><span class="pre">crypto</span></code> 包提供的方法，目前提供<code class="docutils literal notranslate"><span class="pre">AES</span></code>和<code class="docutils literal notranslate"><span class="pre">SM4</span></code>两种方法</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeout</span></code>：（内部查询 <code class="docutils literal notranslate"><span class="pre">hibe.Params</span></code> 的）超时时间，单位：s，若传入-1，将使用默认超时时间：10s</p></li>
</ul>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="nx">CreateHibeTxPayloadParamsWithoutHibeParams</span><span class="p">(</span><span class="nx">contractName</span><span class="p">,</span> <span class="nx">queryParamsMethod</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">plaintext</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">receiverIds</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">receiverOrgIds</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="nx">txId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">keyType</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">KeyType</span><span class="p">,</span> <span class="nx">timeout</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4><span class="section-number">5.1.3.4. </span>查询某一组织的加密公共参数<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p><strong>参数说明</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contractName</span></code>：合约名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method</span></code>：查询方法</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orgId</span></code>: 参与方 <code class="docutils literal notranslate"><span class="pre">id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeout</span></code>: 超时时间，单位：<code class="docutils literal notranslate"><span class="pre">s</span></code>，若传入<code class="docutils literal notranslate"><span class="pre">-1</span></code>，将使用默认超时时间：<code class="docutils literal notranslate"><span class="pre">10s</span></code></p></li>
</ul>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="nx">QueryHibeParamsWithOrgId</span><span class="p">(</span><span class="nx">contractName</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">orgId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">timeout</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id-hibe">
<h5><span class="section-number">5.1.3.4.1. </span>已知交易id，私钥，解密链上hibe交易密文信息<a class="headerlink" href="#id-hibe" title="Permalink to this headline">¶</a></h5>
<p><strong>参数说明</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">localId</span></code>: 本地身份分层加密 <code class="docutils literal notranslate"><span class="pre">id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hibeParams</span></code>: hibeParams 序列化后的byte数组</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hibePrvKey</span></code>: hibe私钥序列化后的byte数组</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">txId</span></code>: 身份分层加密交易 <code class="docutils literal notranslate"><span class="pre">id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyType</span></code>: 对加密信息进行对称解密的方法，请和加密时使用的方法保持一致，请传入 <code class="docutils literal notranslate"><span class="pre">common</span></code> 中 <code class="docutils literal notranslate"><span class="pre">crypto</span></code> 包提供的方法，目前提供<code class="docutils literal notranslate"><span class="pre">AES</span></code>和<code class="docutils literal notranslate"><span class="pre">SM4</span></code>两种方法</p></li>
</ul>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="nx">DecryptHibeTxByTxId</span><span class="p">(</span><span class="nx">localId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">hibeParams</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">hibePrvKey</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">txId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">keyType</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">KeyType</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id6">
<h2><span class="section-number">5.2. </span>用例<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3><span class="section-number">5.2.1. </span>使用 cmc hibe 进行初始化工作<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id8">
<h4><span class="section-number">5.2.1.1. </span>初始化组织分层架构<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>打印文件存储信息，文件存储在指定目录，并根据组织名进行管理：</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./cmc hibe init <span class="se">\</span>
-o wx-org1.chainmaker.org <span class="se">\</span>
-l <span class="m">5</span> <span class="se">\</span>
-s ./hibe-data
<span class="o">[</span>wx-org1.chainmaker.org params<span class="o">]</span> storage file path: hibe-data/wx-org1.chainmaker.org/wx-org1.chainmaker.org.params
<span class="o">[</span>wx-org1.chainmaker.org masterKey<span class="o">]</span> storage file path: hibe-data/wx-org1.chainmaker.org/wx-org1.chainmaker.org.masterKey
</pre></div>
</div>
<p>这就是我们的<code class="docutils literal notranslate"><span class="pre">params</span></code>和<code class="docutils literal notranslate"><span class="pre">masterKey</span></code>，我们可以基于这两个系统参数去生成密钥</p>
<p>此时生成的目录结构如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── hibe-data
│   └── wx-org1.chainmaker.org
│       ├── wx-org1.chainmaker.org.masterKey
│       └── wx-org1.chainmaker.org.params
</pre></div>
</div>
</div>
<div class="section" id="orgid-hibeparams">
<h4><span class="section-number">5.2.1.2. </span>根据根路径和Orgid查看生成的 hibeParams 具体存储路径<a class="headerlink" href="#orgid-hibeparams" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">cmc</span> <span class="n">hibe</span> <span class="n">getParams</span> <span class="o">-</span><span class="n">o</span> <span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span> <span class="o">-</span><span class="n">p</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span>
<span class="p">[</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span> <span class="n">params</span><span class="p">]</span> <span class="n">file</span> <span class="n">path</span><span class="p">:</span> <span class="n">hibe</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">params</span>
<span class="p">[</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span> <span class="n">Params</span><span class="p">]</span> <span class="p">:</span> <span class="o">&amp;</span><span class="p">{</span><span class="n">G</span><span class="p">:</span><span class="n">bn256</span><span class="o">.</span><span class="n">G2</span><span class="p">((</span><span class="mi">47178902283841676690169313198230611764434450586385483963780608219448256132608</span><span class="p">,</span> 
<span class="o">...</span>
<span class="mi">55153595869182115492300723746636577085717766168705040101215917962024994307961</span><span class="p">)]</span> <span class="n">Pairing</span><span class="p">:</span><span class="o">&lt;</span><span class="n">nil</span><span class="o">&gt;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="masterkey">
<h4><span class="section-number">5.2.1.3. </span>根据MasterKey生成私钥<a class="headerlink" href="#masterkey" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">cmc</span> <span class="n">hibe</span> <span class="n">genPrvKey</span> \
<span class="o">-</span><span class="n">m</span> <span class="mi">1</span> \
<span class="o">-</span><span class="n">i</span> <span class="n">wx</span><span class="o">-</span><span class="n">topL</span> \
<span class="o">-</span><span class="n">k</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">masterKey</span> \
<span class="o">-</span><span class="n">p</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">params</span> \
<span class="o">-</span><span class="n">o</span> <span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span> \
<span class="o">-</span><span class="n">s</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span>
<span class="p">[</span><span class="n">wx</span><span class="o">-</span><span class="n">topL</span><span class="p">]</span> <span class="n">privateKey</span> <span class="n">storage</span> <span class="n">file</span> <span class="n">path</span><span class="p">:</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">privateKeys</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">topL</span><span class="o">.</span><span class="n">privateKey</span>
</pre></div>
</div>
<p>打印密钥存储路径，集中管理在 <em>./hibe-data/wx-org1.chainmaker.org/privateKeys</em> ：下</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── hibe-data
    └── wx-org1.chainmaker.org
        ├── privateKeys
        │   └── wx-topL.privateKey
        ├── wx-org1.chainmaker.org.masterKey
        └── wx-org1.chainmaker.org.params
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">masterKey</span></code>是要妥善保管的，下层私钥建议使用第二种方法，基于parentKey进行生成，分发。</p>
<p>例如：我们基于上面生成的私钥为直接下属生成私钥</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">cmc</span> <span class="n">hibe</span> <span class="n">genPrvKey</span> \
<span class="o">-</span><span class="n">m</span> <span class="mi">0</span> \
<span class="o">-</span><span class="n">i</span> <span class="n">wx</span><span class="o">-</span><span class="n">topL</span><span class="o">/</span><span class="n">secondL</span> \
<span class="o">-</span><span class="n">k</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">privateKeys</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">topL</span><span class="o">.</span><span class="n">privateKey</span> \
<span class="o">-</span><span class="n">p</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">params</span> \
<span class="o">-</span><span class="n">o</span> <span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span> \
<span class="o">-</span><span class="n">s</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span>
<span class="p">[</span><span class="n">wx</span><span class="o">-</span><span class="n">topL</span> <span class="n">secondL</span><span class="p">]</span> <span class="n">privateKey</span> <span class="n">storage</span> <span class="n">file</span> <span class="n">path</span><span class="p">:</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">privateKeys</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">topL</span><span class="c1">#secondL.privateKey</span>
</pre></div>
</div>
<p>也可以为自己下属的其他层级员工生成私钥：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">cmc</span> <span class="n">hibe</span> <span class="n">genPrvKey</span> \
<span class="o">-</span><span class="n">m</span> <span class="mi">0</span> \
<span class="o">-</span><span class="n">i</span> <span class="n">wx</span><span class="o">-</span><span class="n">topL</span><span class="o">/</span><span class="n">secondL</span><span class="o">/</span><span class="n">thirdL</span> \
<span class="o">-</span><span class="n">k</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">privateKeys</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">topL</span><span class="o">.</span><span class="n">privateKey</span> \
<span class="o">-</span><span class="n">p</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">params</span> \
<span class="o">-</span><span class="n">o</span> <span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span> \
<span class="o">-</span><span class="n">s</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span>
<span class="p">[</span><span class="n">wx</span><span class="o">-</span><span class="n">topL</span> <span class="n">secondL</span> <span class="n">thirdL</span><span class="p">]</span> <span class="n">privateKey</span> <span class="n">storage</span> <span class="n">file</span> <span class="n">path</span><span class="p">:</span> <span class="o">./</span><span class="n">hibe</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">org1</span><span class="o">.</span><span class="n">chainmaker</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">privateKeys</span><span class="o">/</span><span class="n">wx</span><span class="o">-</span><span class="n">topL</span><span class="c1">#secondL#thirdL.privateKey</span>
</pre></div>
</div>
<p>注意，所有的私钥都平铺在指定目录（这里是 <em>./hibe-data/wx-org1.chainmaker.org/privateKeys</em> ）下进行管理，并且会以 <code class="docutils literal notranslate"><span class="pre">_</span></code> 替换 <code class="docutils literal notranslate"><span class="pre">/</span></code> 之后的<em>ID.privatekey</em>命名，此时的文件夹结构及子密钥名称如下：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span>./hibe-data/
└── wx-org1.chainmaker.org
    ├── privateKeys
    │   ├── wx-topL.privateKey
    │   ├── wx-topL#secondL.privateKey
    │   └── wx-topL#secondL#thirdL.privateKey
    ├── wx-org1.chainmaker.org.masterKey
    └── wx-org1.chainmaker.org.params
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4><span class="section-number">5.2.1.4. </span>私钥文件分发到下属，各自保管，我们在这里把自己的私钥放在在SDK如下路径：<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── testdata
    └── hibe-data
        └── wx-org1.chainmaker.org
            ├── privateKeys
            │   ├── wx-topL.privateKey
            │   ├── wx-topL#secondL.privateKey
            │   └── wx-topL#secondL#thirdL.privateKey
            ├── wx-org1.chainmaker.org.masterKey
            └── wx-org1.chainmaker.org.params
</pre></div>
</div>
</div>
</div>
<div class="section" id="id10">
<h3><span class="section-number">5.2.2. </span>编写智能合约<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="section" id="go">
<h4><span class="section-number">5.2.2.1. </span>使用 go 编写测试的智能合约<a class="headerlink" href="#go" title="Permalink to this headline">¶</a></h4>
<p>智能合约的编写要提供针对<code class="docutils literal notranslate"><span class="pre">hibe.Params</span></code>和<code class="docutils literal notranslate"><span class="pre">hibe.Msg</span></code>存储、查询的方法，建议按照如下格式编写，或内部形成约定，指定好查询两个信息的id(标识)，即存储的Key：</p>
<blockquote>
<div><p>ParamsId: 建议使用 OrgId</p>
<p>HibeMsgId: 使用 TxId</p>
</div></blockquote>
<blockquote>
<div><p>注意：编写的智能合约存储的数据的时候字段名称要和sdk中保持一致：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>	<span class="o">//</span> <span class="n">HibeMsgKey</span> <span class="k">as</span> <span class="n">a</span> <span class="n">payload</span> <span class="n">parameter</span>
	<span class="n">HibeMsgKey</span> <span class="o">=</span> <span class="s2">&quot;hibe_msg&quot;</span>

	<span class="o">//</span> <span class="n">HibeMsgIdKey</span> <span class="n">Key</span> <span class="k">as</span> <span class="n">a</span> <span class="n">hibeMsgMap</span> <span class="n">parameter</span>
	<span class="n">HibeMsgIdKey</span> <span class="o">=</span> <span class="s2">&quot;tx_id&quot;</span>

	<span class="o">//</span> <span class="n">HibeParamsKey</span> <span class="n">The</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">key</span> <span class="p">(</span><span class="n">org_id</span><span class="p">)</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">unique</span> <span class="n">identifier</span> <span class="n">of</span> <span class="n">a</span> <span class="n">HIBE</span> <span class="n">params</span>
	<span class="n">HibeParamsKey</span> <span class="o">=</span> <span class="s2">&quot;org_id&quot;</span>

	<span class="o">//</span> <span class="n">HibeParamsValueKey</span> <span class="n">The</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">key</span> <span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">Hibe</span><span class="s1">&#39;s params</span>
	<span class="n">HibeParamsValueKey</span> <span class="o">=</span> <span class="s2">&quot;params</span>
</pre></div>
</div>
</div></blockquote>
<p>首先我们根据前面的智能合约部分提示，编写一个合约：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="c1">//export init_contract</span>
<span class="kd">func</span> <span class="nx">initContract</span><span class="p">()</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">//export upgrade</span>
<span class="kd">func</span> <span class="nx">upgrade</span><span class="p">()</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">//export save_hibe_params</span>
<span class="kd">func</span> <span class="nx">save_params</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">params</span> <span class="o">:=</span> <span class="nx">Args</span><span class="p">()</span>
	<span class="nx">itemMap</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="nx">itemMap</span> <span class="p">=</span> <span class="nx">EasyCodecItemToParamsMap</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
	<span class="nx">itemBytes</span> <span class="o">:=</span> <span class="nx">EasyMarshal</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span>
	<span class="nx">PutState</span><span class="p">(</span><span class="s">&quot;hibe_params&quot;</span><span class="p">,</span> <span class="nx">itemMap</span><span class="p">[</span><span class="s">&quot;org_id&quot;</span><span class="p">],</span> <span class="nb">string</span><span class="p">(</span><span class="nx">itemBytes</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">//export find_params_by_org_id</span>
<span class="kd">func</span> <span class="nx">findParamsByOrgId</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">org_id</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">Arg</span><span class="p">(</span><span class="s">&quot;org_id&quot;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">resultCode</span> <span class="o">:=</span> <span class="nx">GetStateByte</span><span class="p">(</span><span class="s">&quot;hibe_params&quot;</span><span class="p">,</span> <span class="nx">org_id</span><span class="p">);</span> <span class="nx">resultCode</span> <span class="o">!=</span> <span class="nx">SUCCESS</span> <span class="p">{</span>
		<span class="nx">ErrorResult</span><span class="p">(</span><span class="s">&quot;错误提示 ， orgId:&quot;</span> <span class="o">+</span> <span class="nx">org_id</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">LogMessage</span><span class="p">(</span><span class="s">&quot;get val:&quot;</span> <span class="o">+</span> <span class="nb">string</span><span class="p">(</span><span class="nx">result</span><span class="p">))</span>
		<span class="nx">SuccessResultByte</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">//export save_hibe_msg</span>
<span class="kd">func</span> <span class="nx">saveHibeMsg</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">parameters</span> <span class="o">:=</span> <span class="nx">Args</span><span class="p">()</span>

	<span class="nx">stones</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">elem</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">parameters</span> <span class="p">{</span>
		<span class="nx">stones</span><span class="p">[</span><span class="nx">elem</span><span class="p">.</span><span class="nx">Key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">Value</span><span class="p">.(</span><span class="kt">string</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">items</span> <span class="o">:=</span> <span class="nx">ParamsMapToEasyCodecItem</span><span class="p">(</span><span class="nx">stones</span><span class="p">)</span>
	<span class="nx">itemsBytes</span> <span class="o">:=</span> <span class="nx">EasyMarshal</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span>
	<span class="nx">logMessage</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">itemsBytes</span><span class="p">))</span>

	<span class="nx">PutState</span><span class="p">(</span><span class="s">&quot;hibe&quot;</span><span class="p">,</span> <span class="nx">stones</span><span class="p">[</span><span class="s">&quot;tx_id&quot;</span><span class="p">],</span> <span class="nb">string</span><span class="p">(</span><span class="nx">itemsBytes</span><span class="p">))</span>

<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h4><span class="section-number">5.2.2.2. </span>编译字节码文件放到项目中<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>使用<code class="docutils literal notranslate"><span class="pre">tinygo</span> <span class="pre">build</span> <span class="pre">-no-debug</span> <span class="pre">-opt=s</span> <span class="pre">-o</span> <span class="pre">contract-hibe-1.0.0.wasm</span> <span class="pre">-target</span> <span class="pre">wasm</span></code>生成合约字节码文件，放入到SDK下，本例放到如下路径（使用的时候要在 SDK 中指定配置位置）：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── testdata
│   ├── counter-go-demo
│   │   ├── contract-hibe-1.0.0.wasm
</pre></div>
</div>
</div>
</div>
<div class="section" id="id12">
<h3><span class="section-number">5.2.3. </span>使用SDK和密钥文件对信息加密上链并从链上获取和加密<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<div class="section" id="hibekey">
<h4><span class="section-number">5.2.3.1. </span>HIBE相关消息Key规定<a class="headerlink" href="#hibekey" title="Permalink to this headline">¶</a></h4>
<p>下面三个方法名是测试的示例合约提供的方法，分别是 <code class="docutils literal notranslate"><span class="pre">hibeParams</span></code>和<code class="docutils literal notranslate"><span class="pre">hibemsg</span></code>的存储和查询方法。</p>
<p>下面是合约存储数据规定的一些Key，</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">HIBE_BIZID_KEY</span></code> ：整个hibe消息的合约查询Key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HIBE_MSG_KEY</span></code>：hibe消息体的Key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HIBE_MSG_CIPHER_TEXT_KEY</span></code>：消息体里被加密信息的Key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HIBE_PARAMS_KEY</span></code>：params消息的合约查询Key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HIBE_PARAMS_VALUE_KEY</span></code>：params 值的 Key</p></li>
</ul>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// hibe msg&#39;s Keys</span>
<span class="kd">const</span> <span class="p">(</span>
	<span class="c1">// HibeMsgKey as a payload parameter</span>
	<span class="nx">HibeMsgKey</span> <span class="p">=</span> <span class="s">&quot;hibe_msg&quot;</span>

	<span class="c1">// HibeMsgIdKey Key as a hibeMsgMap parameter</span>
	<span class="nx">HibeMsgIdKey</span> <span class="p">=</span> <span class="s">&quot;tx_id&quot;</span>

	<span class="c1">// HibeMsgCipherTextKey Key as a hibeMsgMap parameter</span>
	<span class="c1">// The value of the key (CT) is the hibe_msg&#39;s message (ciphertext)</span>
	<span class="nx">HibeMsgCipherTextKey</span> <span class="p">=</span> <span class="s">&quot;CT&quot;</span>

	<span class="c1">// HibeParamsKey The value of the key (org_id) is the unique identifier of a HIBE params</span>
	<span class="nx">HibeParamsKey</span> <span class="p">=</span> <span class="s">&quot;org_id&quot;</span>

	<span class="c1">// HibeParamsValueKey The value of the key (params) is the Hibe&#39;s params</span>
	<span class="nx">HibeParamsValueKey</span> <span class="p">=</span> <span class="s">&quot;params&quot;</span>
</pre></div>
</div>
<p>测试合约的方法名：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// test contract functionName</span>
<span class="kd">const</span> <span class="p">(</span>
	<span class="c1">// save Hibe Message</span>
	<span class="nx">saveHibeMsg</span> <span class="p">=</span> <span class="s">&quot;save_hibe_msg&quot;</span>

	<span class="c1">// save params</span>
	<span class="nx">saveHibeParams</span> <span class="p">=</span> <span class="s">&quot;save_hibe_params&quot;</span>

	<span class="c1">// find params by ogrId</span>
	<span class="nx">findParamsByOrgId</span> <span class="p">=</span> <span class="s">&quot;find_params_by_org_id&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h4><span class="section-number">5.2.3.2. </span>前置数据<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>提前准备了一些数据来做测试，包括超时时间、本地 <code class="docutils literal notranslate"><span class="pre">hibeParams</span></code> 存储路径，测试消息、<code class="docutils literal notranslate"><span class="pre">hibe_msg</span></code>信息标识以及测试的三组<code class="docutils literal notranslate"><span class="pre">ID</span></code>和对应的私钥文件。（一般使用时本地只存放自己的私钥文件和本公司的 <code class="docutils literal notranslate"><span class="pre">hibeParams</span></code> 文件）。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// test data</span>
<span class="kd">const</span> <span class="p">(</span>
	<span class="nx">hibeContractByteCodePath</span> <span class="p">=</span> <span class="s">&quot;./testdata/counter-go-demo/contract-hibe-1.0.0.wasm&quot;</span>

	<span class="c1">//</span>
	<span class="nx">hibeContractName</span> <span class="p">=</span> <span class="s">&quot;contract-hibe-1&quot;</span>

	<span class="c1">// 本地 hibe params 文件路径</span>
	<span class="nx">localHibeParamsFilePath</span> <span class="p">=</span> <span class="s">&quot;./testdata/hibe-data/wx-org1.chainmaker.org/wx-org1.chainmaker.org.params&quot;</span>

	<span class="c1">// 测试源消息</span>
	<span class="nx">msg</span> <span class="p">=</span> <span class="s">&quot;这是一条HIBE测试存证 ✔✔✔&quot;</span>

	<span class="c1">// hibe_msg 的消息 Id</span>
	<span class="nx">bizId2</span> <span class="p">=</span> <span class="s">&quot;1234567890123452&quot;</span>

	<span class="c1">// Id 和 对应私钥文件路径 这里测试3组</span>
	<span class="nx">localTopLevelId</span>                 <span class="p">=</span> <span class="s">&quot;wx-topL&quot;</span>
	<span class="nx">localTopLevelHibePrvKeyFilePath</span> <span class="p">=</span> <span class="s">&quot;./testdata/hibe-data/wx-org1.chainmaker.org/privateKeys/wx-topL.privateKey&quot;</span>

	<span class="nx">localSecondLevelId</span>                 <span class="p">=</span> <span class="s">&quot;wx-topL/secondL&quot;</span>
	<span class="nx">localSecondLevelHibePrvKeyFilePath</span> <span class="p">=</span> <span class="s">&quot;./testdata/hibe-data/wx-org1.chainmaker.org/privateKeys/wx-topL#secondL.privateKey&quot;</span>

	<span class="nx">localThirdLevelId</span>                 <span class="p">=</span> <span class="s">&quot;wx-topL/secondL/thirdL&quot;</span>
	<span class="nx">localThirdLevelHibePrvKeyFilePath</span> <span class="p">=</span> <span class="s">&quot;./testdata/hibe-data/wx-org1.chainmaker.org/privateKeys/wx-topL#secondL#thirdL.privateKey&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h4><span class="section-number">5.2.3.3. </span>初始化客户端，进行测试<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">TestHibeContractCounterGo</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>

	<span class="nx">txId</span> <span class="p">=</span> <span class="nx">GetRandTxId</span><span class="p">()</span>
	<span class="nx">client</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">createClientWithConfig</span><span class="p">()</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>

	<span class="nx">admin1</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">createAdmin</span><span class="p">(</span><span class="nx">orgId1</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="nx">admin2</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">createAdmin</span><span class="p">(</span><span class="nx">orgId2</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="nx">admin3</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">createAdmin</span><span class="p">(</span><span class="nx">orgId3</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="nx">admin4</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">createAdmin</span><span class="p">(</span><span class="nx">orgId4</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;====================== 创建合约（异步）======================&quot;</span><span class="p">)</span>
	<span class="nx">testUserHibeContractCounterGoCreate</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">admin1</span><span class="p">,</span> <span class="nx">admin2</span><span class="p">,</span> <span class="nx">admin3</span><span class="p">,</span> <span class="nx">admin4</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
	<span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;====================== 调用合约 params 上链 （异步）======================&quot;</span><span class="p">)</span>
	<span class="nx">testUserHibeContractParamsGoInvoke</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">saveHibeParams</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
	<span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;====================== 执行合约 params 查询接口 ======================&quot;</span><span class="p">)</span>
	<span class="nx">testUserHibeContractParamsGoQuery</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">findParamsByOrgId</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;====================== 调用合约 加密数据上链（异步）======================&quot;</span><span class="p">)</span>
	<span class="nx">testUserHibeContractMsgGoInvoke</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">saveHibeMsg</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
	<span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;====================== 执行合约 加密数据查询接口 ======================&quot;</span><span class="p">)</span>
	<span class="nx">testUserHibeContractMsgGoQuery</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">client</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h4><span class="section-number">5.2.3.4. </span>创建合约<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// 创建Hibe合约</span>
<span class="kd">func</span> <span class="nx">testUserHibeContractCounterGoCreate</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">client</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">,</span>
	<span class="nx">admin1</span><span class="p">,</span> <span class="nx">admin2</span><span class="p">,</span> <span class="nx">admin3</span><span class="p">,</span> <span class="nx">admin4</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">,</span> <span class="nx">withSyncResult</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>

	<span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">createUserHibeContract</span><span class="p">(</span><span class="nx">client</span><span class="p">,</span> <span class="nx">admin1</span><span class="p">,</span> <span class="nx">admin2</span><span class="p">,</span> <span class="nx">admin3</span><span class="p">,</span> <span class="nx">admin4</span><span class="p">,</span>
		<span class="nx">hibeContractName</span><span class="p">,</span> <span class="nx">version</span><span class="p">,</span> <span class="nx">hibeContractByteCodePath</span><span class="p">,</span> <span class="nx">common</span><span class="p">.</span><span class="nx">RuntimeType_GASM</span><span class="p">,</span> <span class="p">[]</span><span class="o">*</span><span class="nx">common</span><span class="p">.</span><span class="nx">KeyValuePair</span><span class="p">{},</span> <span class="nx">withSyncResult</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>

	<span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;CREATE contract-hibe-1 contract resp: %+v\n&quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span>
</pre></div>
</div>
<p>创建合约要指定合约名，合约版本，合约字节码文件位置，和运行时环境等，具体流程如下：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">createUserHibeContract</span><span class="p">(</span><span class="nx">client</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">,</span> <span class="nx">admin1</span><span class="p">,</span> <span class="nx">admin2</span><span class="p">,</span> <span class="nx">admin3</span><span class="p">,</span> <span class="nx">admin4</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">,</span>
	<span class="nx">contractName</span><span class="p">,</span> <span class="nx">version</span><span class="p">,</span> <span class="nx">byteCodePath</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">runtime</span> <span class="nx">common</span><span class="p">.</span><span class="nx">RuntimeType</span><span class="p">,</span> <span class="nx">kvs</span> <span class="p">[]</span><span class="o">*</span><span class="nx">common</span><span class="p">.</span><span class="nx">KeyValuePair</span><span class="p">,</span> <span class="nx">withSyncResult</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">common</span><span class="p">.</span><span class="nx">TxResponse</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>

	<span class="nx">payloadBytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">CreateContractCreatePayload</span><span class="p">(</span><span class="nx">contractName</span><span class="p">,</span> <span class="nx">version</span><span class="p">,</span> <span class="nx">byteCodePath</span><span class="p">,</span> <span class="nx">runtime</span><span class="p">,</span> <span class="nx">kvs</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="c1">// 各组织Admin权限用户签名</span>
	<span class="nx">signedPayloadBytes1</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">admin1</span><span class="p">.</span><span class="nx">SignContractManagePayload</span><span class="p">(</span><span class="nx">payloadBytes</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">signedPayloadBytes2</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">admin2</span><span class="p">.</span><span class="nx">SignContractManagePayload</span><span class="p">(</span><span class="nx">payloadBytes</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">signedPayloadBytes3</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">admin3</span><span class="p">.</span><span class="nx">SignContractManagePayload</span><span class="p">(</span><span class="nx">payloadBytes</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">signedPayloadBytes4</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">admin4</span><span class="p">.</span><span class="nx">SignContractManagePayload</span><span class="p">(</span><span class="nx">payloadBytes</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="c1">// 收集并合并签名</span>
	<span class="nx">mergeSignedPayloadBytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">MergeContractManageSignedPayload</span><span class="p">([][]</span><span class="kt">byte</span><span class="p">{</span><span class="nx">signedPayloadBytes1</span><span class="p">,</span>
		<span class="nx">signedPayloadBytes2</span><span class="p">,</span> <span class="nx">signedPayloadBytes3</span><span class="p">,</span> <span class="nx">signedPayloadBytes4</span><span class="p">})</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="c1">// 发送创建合约请求</span>
	<span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">SendContractManageRequest</span><span class="p">(</span><span class="nx">mergeSignedPayloadBytes</span><span class="p">,</span> <span class="nx">createContractTimeout</span><span class="p">,</span> <span class="nx">withSyncResult</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">err</span> <span class="p">=</span> <span class="nx">checkProposalRequestResp</span><span class="p">(</span><span class="nx">resp</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">resp</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="params">
<h4><span class="section-number">5.2.3.5. </span>本地 params 上链<a class="headerlink" href="#params" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// 调用Hibe合约</span>
<span class="c1">// params 上链</span>
<span class="kd">func</span> <span class="nx">testUserHibeContractParamsGoInvoke</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">client</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">,</span>
	<span class="nx">method</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">withSyncResult</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">invokeUserHibeContractParams</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">hibeContractName</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nx">withSyncResult</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上链要指定合约名，存储上链的合约方法，本地<code class="docutils literal notranslate"><span class="pre">hibeParams</span></code>文件路径等，先构造存储 <code class="docutils literal notranslate"><span class="pre">hibeParams</span></code>的<code class="docutils literal notranslate"><span class="pre">payloadParams</span></code>，然后调用<code class="docutils literal notranslate"><span class="pre">InvokeContract</span></code>接口上链：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">invokeUserHibeContractParams</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">client</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">,</span> <span class="nx">contractName</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">txId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">withSyncResult</span> <span class="kt">bool</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">localParams</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ReadHibeParamsWithFilePath</span><span class="p">(</span><span class="nx">localHibeParamsFilePath</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="nx">payloadParams</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">CreateHibeInitParamsTxPayloadParams</span><span class="p">(</span><span class="nx">orgId1</span><span class="p">,</span> <span class="nx">localParams</span><span class="p">)</span>
	<span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">InvokeContract</span><span class="p">(</span><span class="nx">contractName</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">txId</span><span class="p">,</span> <span class="nx">payloadParams</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">withSyncResult</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Code</span> <span class="o">!=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">TxStatusCode_SUCCESS</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invoke contract failed, [code:%d]/[msg:%s]\n&quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">!</span><span class="nx">withSyncResult</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;invoke contract success, resp: [code:%d]/[msg:%s]/[txId:%s]\n&quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Message</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">ContractResult</span><span class="p">.</span><span class="nx">Result</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;invoke contract success, resp: [code:%d]/[msg:%s]/[contractResult:%s]\n&quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Message</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">ContractResult</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="idparams">
<h4><span class="section-number">5.2.3.6. </span>根据组织Id链上查询其公司Params<a class="headerlink" href="#idparams" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// params 查询</span>
<span class="kd">func</span> <span class="nx">testUserHibeContractParamsGoQuery</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">client</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">,</span>
	<span class="nx">method</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">params</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">hibeParams</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">QueryHibeParamsWithOrgId</span><span class="p">(</span><span class="nx">hibeContractName</span><span class="p">,</span> <span class="nx">findParamsByOrgId</span><span class="p">,</span> <span class="nx">orgId1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;QUERY %s contract resp -&gt; hibeParams:%s\n&quot;</span><span class="p">,</span> <span class="nx">hibeContractName</span><span class="p">,</span> <span class="nx">hibeParams</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h4><span class="section-number">5.2.3.7. </span>hibe加密信息上链<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// 加密数据上链</span>
<span class="kd">func</span> <span class="nx">testUserHibeContractMsgGoInvoke</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">client</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">,</span>
	<span class="nx">method</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">withSyncResult</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">invokeUserHibeContractMsg</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">hibeContractName</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">txId</span><span class="p">,</span> <span class="nx">withSyncResult</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>加密信息上链需要指定合约名、合约方法、要加密上链的明文信息，可解密者的ID及其公司Params、对文本进行对称加密的算法（目前支持AES、SM4(key目前不支持传递，统一内部设定为128bit)），具体使用方法如下：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">invokeUserHibeContractMsg</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">client</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">,</span> <span class="nx">contractName</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">txId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">withSyncResult</span> <span class="kt">bool</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">receiverId</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
	<span class="nx">receiverId</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="nx">localSecondLevelId</span>
	<span class="nx">receiverId</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="nx">localThirdLevelId</span>
	<span class="nx">receiverId</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">=</span> <span class="nx">localTopLevelId</span>

	<span class="c1">// fetch orgId []string from receiverId []string</span>
	<span class="nx">org</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">receiverId</span><span class="p">))</span>
	<span class="nx">org</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;wx-org1.chainmaker.org&quot;</span>
	<span class="nx">org</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;wx-org1.chainmaker.org&quot;</span>
	<span class="nx">org</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;wx-org1.chainmaker.org&quot;</span>

	<span class="c1">// query params</span>
	<span class="nx">paramsBytesList</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([][]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">id</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">org</span> <span class="p">{</span>
		<span class="nx">hibeParamsBytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">QueryHibeParamsWithOrgId</span><span class="p">(</span><span class="nx">hibeContractName</span><span class="p">,</span> <span class="nx">findParamsByOrgId</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="c1">//t.Logf(&quot;QUERY hibe-contract-go-1 contract resp: %+v\n&quot;, hibeParams)</span>
			<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;client.QueryHibeParamsWithOrgId(hibeContractName, id, -1) failed, err: %v\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">hibeParamsBytes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;no souch params of %s&#39;s org, please check it&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span>
		<span class="p">}</span>

		<span class="nx">paramsBytesList</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">paramsBytesList</span><span class="p">,</span> <span class="nx">hibeParamsBytes</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">keyType</span> <span class="o">:=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">AES</span>
	<span class="c1">//keyType := crypto.SM4</span>
	<span class="nx">params</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">CreateHibeTxPayloadParamsWithHibeParams</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">msg</span><span class="p">),</span> <span class="nx">receiverId</span><span class="p">,</span> <span class="nx">paramsBytesList</span><span class="p">,</span> <span class="nx">txId</span><span class="p">,</span> <span class="nx">keyType</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">resp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">InvokeContract</span><span class="p">(</span><span class="nx">contractName</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">txId</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">withSyncResult</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Code</span> <span class="o">!=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">TxStatusCode_SUCCESS</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;invoke contract failed, [code:%d]/[msg:%s]\n&quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">!</span><span class="nx">withSyncResult</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;invoke contract success, resp: [code:%d]/[msg:%s]/[txId:%s]\n&quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Message</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">ContractResult</span><span class="p">.</span><span class="nx">Result</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;invoke contract success, resp: [code:%d]/[msg:%s]/[contractResult:%s]\n&quot;</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Code</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">Message</span><span class="p">,</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">ContractResult</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="hibemsg">
<h4><span class="section-number">5.2.3.8. </span>获取链上的 <code class="docutils literal notranslate"><span class="pre">hibeMsg</span></code> 并解密：<a class="headerlink" href="#hibemsg" title="Permalink to this headline">¶</a></h4>
<p>解密时需要注意，解密的时候指定的算法要和加密时候的算法相同！</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// 获取加密数据</span>
<span class="kd">func</span> <span class="nx">testUserHibeContractMsgGoQuery</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">client</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">keyType</span> <span class="o">:=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">AES</span>
	<span class="c1">//keyType := crypto.SM4</span>

	<span class="nx">localParams</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ReadHibeParamsWithFilePath</span><span class="p">(</span><span class="nx">localHibeParamsFilePath</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>

	<span class="nx">topHibePrvKey</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ReadHibePrvKeysWithFilePath</span><span class="p">(</span><span class="nx">localTopLevelHibePrvKeyFilePath</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>

	<span class="nx">msgBytes1</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">DecryptHibeTxByTxId</span><span class="p">(</span><span class="nx">localTopLevelId</span><span class="p">,</span> <span class="nx">localParams</span><span class="p">,</span> <span class="nx">topHibePrvKey</span><span class="p">,</span> <span class="nx">txId</span><span class="p">,</span> <span class="nx">keyType</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;QUERY hibe-contract-go-1 contract resp DecryptHibeTxByBizId [Decrypt Msg By TopLevel privateKey] message: %s\n&quot;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">msgBytes1</span><span class="p">))</span>

	<span class="nx">msgBytes2</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">DecryptHibeTxByTxId</span><span class="p">(</span><span class="nx">localTopLevelId</span><span class="p">,</span> <span class="nx">localParams</span><span class="p">,</span> <span class="nx">topHibePrvKey</span><span class="p">,</span> <span class="nx">txId</span><span class="p">,</span> <span class="nx">keyType</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;QUERY hibe-contract-go-1 contract resp DecryptHibeTxByBizId [Decrypt Msg By SecondLevel privateKey] message: %s\n&quot;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">msgBytes2</span><span class="p">))</span>

	<span class="nx">msgBytes3</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">DecryptHibeTxByTxId</span><span class="p">(</span><span class="nx">localTopLevelId</span><span class="p">,</span> <span class="nx">localParams</span><span class="p">,</span> <span class="nx">topHibePrvKey</span><span class="p">,</span> <span class="nx">txId</span><span class="p">,</span> <span class="nx">keyType</span><span class="p">)</span>
	<span class="nx">require</span><span class="p">.</span><span class="nx">Nil</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="nx">t</span><span class="p">.</span><span class="nx">Logf</span><span class="p">(</span><span class="s">&quot;QUERY hibe-contract-go-1 contract resp DecryptHibeTxByBizId [Decrypt Msg By ThirdLevel privateKey] message: %s\n&quot;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">msgBytes3</span><span class="p">))</span>

<span class="p">}</span>
</pre></div>
</div>
<p>上面是指定AES算法，下面指定SM4算法测试：</p>
<p>加密处指定SM4：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">invokeUserHibeContractMsg</span><span class="p">(</span><span class="nx">client</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">,</span> <span class="nx">contractName</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="nx">txId</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">withSyncResult</span> <span class="kt">bool</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="c1">// ...</span>
	
	<span class="c1">//keyType := crypto.AES</span>
	<span class="nx">keyType</span> <span class="o">:=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">SM4</span>
	<span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>解密处指定SM4算法：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// 获取加密数据</span>
<span class="kd">func</span> <span class="nx">testUserHibeContractMsgGoQuery</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">client</span> <span class="o">*</span><span class="nx">ChainClient</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">//keyType := crypto.AES</span>
	<span class="nx">keyType</span> <span class="o">:=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">SM4</span>
	<span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h4><span class="section-number">5.2.3.9. </span>执行测试：<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>====================== 创建合约（异步）======================
2021-04-23 22:16:27.226	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_user_contract.go:31	[SDK] create [ContractCreate] to be signed payload
2021-04-23 22:16:27.226	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_user_contract.go:60	[SDK] create [ContractManage] to be signed payload
2021-04-23 22:16:27.230	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_client.go:351	[SDK] proposalRequest resp: message:&quot;OK&quot; 
    sdk_hibe_test.go:95: CREATE contract-hibe-1 contract resp: message:&quot;OK&quot; contract_result:&lt;result:&quot;da36c5ae4d29439bbf589b088347e3843540853b50f94f3e9c3d074c60d9b043&quot; message:&quot;OK&quot; &gt; 
====================== 调用合约 params 上链 （异步）======================
�`�[*�Eꑃ�r��B....�]�1y]]
2021-04-23 22:16:32.232	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_client.go:351	[SDK] proposalRequest resp: message:&quot;OK&quot; 
    sdk_hibe_test.go:224: invoke contract success, resp: [code:0]/[msg:OK]/[txId:0bfe933152664c918ba07dd5007bfb4dd7de5631497d4857a8dbcbc14d6dd260]
====================== 执行合约 params 查询接口 ======================
2021-04-23 22:16:37.233	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_user_contract.go:240	[SDK] begin to QUERY contract, [contractName:contract-hibe-1]/[method:find_params_by_org_id]/[txId:2e018185e4c6437f94ea0d49fb9677759d6593a756da4b14bf921e9c8fd634e2]/[params:map[org_id:wx-org1.chainmaker.org]]
2021-04-23 22:16:37.245	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_client.go:351	[SDK] proposalRequest resp: message:&quot;SUCCESS&quot; contract_result:...10\224]\2331\177y&quot; gas_used:11114830 &gt; 
�`�[*�Eꑃ�r��B�`.....)Q�&lt;ϙ=!�6WT��
====================== 调用合约 加密数据上链（异步）======================
2021-04-23 22:16:37.246	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_user_contract.go:240	[SDK] begin to QUERY contract, [contractName:contract-hibe-1]/[method:find_params_by_org_id]/[txId:ca07d3ee21a54bf2ae3679af9719f02221877cd04da34516a5ce12e091fd0e0a]/[params:map[org_id:wx-org1.chainmaker.org]]
2021-04-23 22:16:37.259	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_client.go:351	[SDK] proposalRequest resp: message:&quot;SUCCESS&quot; contract_result:&lt;result:&quot;\013\000\000\0...\224]\2331\177y&quot; gas_used:11114830 &gt; 
2021-04-23 22:16:37.260	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_user_contract.go:240	[SDK] begin to QUERY contract, [contractName:contract-hibe-1]/[method:find_params_by_org_id]/[txId:519b7ff922124f60b8dd8dcbebb5286586b8f0b03139460fb0559528da8be996]/[params:map[org_id:wx-org1.chainmaker.org]]
2021-04-23 22:16:37.271	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_client.go:351	[SDK] proposalRequest resp: message:&quot;SUCCESS&quot; contract_result:&lt;result:&quot;\013\000\000\000\001\...331\177y&quot; gas_used:11114830 &gt; 
2021-04-23 22:16:37.272	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_user_contract.go:240	[SDK] begin to QUERY contract, [contractName:contract-hibe-1]/[method:find_params_by_org_id]/[txId:0b20ddd3c7474325a75077179913f44439b4fa71ec4c483aa5013b575f2af444]/[params:map[org_id:wx-org1.chainmaker.org]]
2021-04-23 22:16:37.283	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_client.go:351	[SDK] proposalRequest resp: message:&quot;SUCCESS&quot; contract_result:&lt;result:&quot;\013\000\000\000\001\000...\305[\317\014@\306G\202V\224y\357\324:N\023\231\375\225\351&#39;G\365\035\225\246\335\357\272J\265n;=\276\010\224]\2331\177y&quot; gas_used:11114830 &gt; 
2021-04-23 22:16:37.294	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_user_contract.go:197	[SDK] begin to INVOKE contract, [contractName:contract-hibe-1]/[method:save_hibe_msg]/[txId:d2f51965405f4f04bd1a622904114c1cb4171c98f5534c828e29d560a7b9a130]/[params:map[hibe_msg:{&quot;CT&quot;:&quot;igAoeoyhpAjaCZOe9dzeaEO6cIYB4hBRcv/SMuP/REwZLbAyomMe46lbIof4S7K5bJhAs10wA+x2roo6xZYjDg==&quot;,&quot;wx-topL/secondL/thirdL&quot;:&quot;SZoLPK/fu/3awMYZ8k/e9aTP9AJyXKYEvF4gNsXNVshdnN5G5tNHWKk93PYhCtIut2suZ+YBNHydNrshf5VewEOH0wZ9rPFr0iEY/voAYilif7gFLSdaFjy/yknBG894W5rVYdYsipHV5+35kMsOKh70jvr5eBwFEVTYZ5e91d6OxJ8cGwGIWNBezLLnDXuHNXtXhOD2+3+56ZEceuIow33Qo+yAaxUWE09XvOvmZkhHW+PrVYwqKyleWcUmgsOjR9X4iwZI4NUEzBUK6MQVVV9I6fkZHfxea9I0EpWt+HtXAyIiYGc2Flz/PjvMAmx/3h6XtliYSJWgek60FtNcpUKZFanr3905v/3+cAMnY3SkKXE/3UqG3eY1rq1TYT8AK6GIdKeaO70Lhjzzu5o0eMsF3i3zAT+GFhtLy6cfEe0FZIAqSiXJAVasfxoiYOyPSubChCDKGY4wCUe2zKTsT0RirQB0JjB9TGwJFTl+ZGfT3NesvDW39QMkuij4sh9EQ5IEfHOyU2ulnCXKPRbW8FMiG2t6EEdEKyv/JLEPmd1RYxm4A1WwmHZ2B8sE0MdADIk5nfVX3A7tKbo06t+OJYNEJezrNkhqDVSXGdJ/ydLAn8VBevmSHjeNDgEIobjOc1ZMg3VpoQ40eviQwblsLep/pyTEuXw1pveuoD0Rz5c16GjiV5a9KHh5ak+HMxjZ9nX8J6zRIzRCG4ltwrqOtDNd0qktef/EhXrIb5pEe8qcbHkEUK4yRYnpP61e1x59&quot;} tx_id:d2f51965405f4f04bd1a622904114c1cb4171c98f5534c828e29d560a7b9a130]]
2021-04-23 22:16:37.295	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_client.go:351	[SDK] proposalRequest resp: message:&quot;OK&quot; 
    sdk_hibe_test.go:281: invoke contract success, resp: [code:0]/[msg:OK]/[txId:d2f51965405f4f04bd1a622904114c1cb4171c98f5534c828e29d560a7b9a130]
====================== 执行合约 加密数据查询接口 ======================
2021-04-23 22:16:42.295	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_system_contract.go:24	[SDK] begin to QUERY system contract, [method:GET_TX_BY_TX_ID]/[txId:d2f51965405f4f04bd1a622904114c1cb4171c98f5534c828e29d560a7b9a130]
2021-04-23 22:16:42.298	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_client.go:351	[SDK] proposalRequest resp: message:&quot;SUCCESS&quot; contract_result:&lt;result:&quot;\n\376\t... message:&quot;OK&quot; &gt; 
    sdk_hibe_test.go:146: QUERY hibe-contract-go-1 contract resp DecryptHibeTxByBizId [Decrypt Msg By TopLevel privateKey] message: 这是一条HIBE测试存证 ✔✔✔
2021-04-23 22:16:42.334	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_system_contract.go:24	[SDK] begin to QUERY system contract, [method:GET_TX_BY_TX_ID]/[txId:d2f51965405f4f04bd1a622904114c1cb4171c98f5534c828e29d560a7b9a130]
2021-04-23 22:16:42.335	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_client.go:351	[SDK] proposalRequest resp: message:&quot;SUCCESS&quot; contract_result:&lt;result:&quot;\n\376\t\n\21... message:&quot;OK&quot; &gt; 
    sdk_hibe_test.go:150: QUERY hibe-contract-go-1 contract resp DecryptHibeTxByBizId [Decrypt Msg By SecondLevel privateKey] message: 这是一条HIBE测试存证 ✔✔✔
2021-04-23 22:16:42.352	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_system_contract.go:24	[SDK] begin to QUERY system contract, [method:GET_TX_BY_TX_ID]/[txId:d2f51965405f4f04bd1a622904114c1cb4171c98f5534c828e29d560a7b9a130]
2021-04-23 22:16:42.353	[DEBUG]	[SDK]	chainmaker-sdk-go/sdk_client.go:351	[SDK] proposalRequest resp: message:&quot;SUCCESS&quot; contract_result:&lt;result:&quot;\n\376\t\n\214\001\n\00... message:&quot;OK&quot; &gt; 
    sdk_hibe_test.go:154: QUERY hibe-contract-go-1 contract resp DecryptHibeTxByBizId [Decrypt Msg By ThirdLevel privateKey] message: 这是一条HIBE测试存证 ✔✔✔
--- PASS: TestHibeContractCounterGo (15.18s)
PASS
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97.html" class="btn btn-neutral float-right" title="6. 版本升级操作指南" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="%E9%85%8D%E7%BD%AE%E5%8F%98%E6%9B%B4.html" class="btn btn-neutral float-left" title="4. 配置变更" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright chainmaker.org.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>